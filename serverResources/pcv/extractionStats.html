
<!DOCTYPE HTML>
<html>
  <head>
	<title>Population Info</title>
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
	<script src="/pcv/jsLibs"></script>
	<script src="/pcv/jsOwn"></script>
	<script src="/pcv/jsPcv"></script>
	<link rel="stylesheet" href="/pcv/cssLibs">
	<link rel="stylesheet" href="/pcv/cssOwn">
	<link rel="stylesheet" href="/pcv/cssPcv">
  </head>
  <body>
    <script>
    	$(document).ready(function(){
    		//get current name from window location
			var locSplit = window.location.toString().split(/[\/]+/);
			var rName = locSplit[2];
			var projectName = locSplit[4];
			//change title to current name
			var longProjectName = ajaxRet('/' + rName + '/projectName/' + projectName);		
			addDiv("body", "topNav");
			createProjectNavBar("#topNav", rName, projectName);
			addMainDiv("body", true);
			setHeadTitle(longProjectName);
			$("#jumboTitle").html(longProjectName + " Extraction Information");
			addPanelOnlyHead("#mainContent", "Sample Extraction Information");	
			addDiv("#mainContent", "sampTable");
			addDiv("#mainContent", "sampNameMenu");
			addPanelOnlyHead("#mainContent", "Extraction By File");
			addDiv("#mainContent", "popTable");

			
			var sampNames = ajaxRet("/" + rName + "/allSampleNames/" + projectName);
			var sampNameEncoding = ajaxRet('/' + rName + '/sampleNamesEncoding/' + projectName);
			var encodedSampNames =[];
	    	for (sampN in sampNames){
	    		encodedSampNames.push(sampNameEncoding[sampNames[sampN]]);
	    	}
	    	var mainPopInfoTab;
			ajaxPost('/' + rName + '/getSampleExtractionInfo/' + projectName, {"sampNames": encodedSampNames}, function(tab){ mainPopInfoTab = tab; });
			


			if(mainPopInfoTab !== null){
				//get the population information table from server
				var popInfoTab;
				ajax('/' + rName + '/getIndexExtractionInfo/' + projectName, function(tab){ popInfoTab = tab; });

				var sampleTable =  new njhTable("#sampTable", mainPopInfoTab, longProjectName + "_extractionByFileInfo", true);	
				
				//update the chart and table on click of the sample checkboxes
				function updateChartOnClick() { 
					//get all currently checked sample boxes and then update the current samples  
				    var allVals = [];
				    $('#sampNameMenu :checked').each(function() {
				      allVals.push($(this).val());
				    });
				    var currentSampNames = _.intersection(sampNames, allVals);
				    if(currentSampNames.length == 0){
				    	mainPopInfoTab = {};
				    }else{
				    	var encodedCurrentSampNames =[];
				    	for (sampN in currentSampNames){
				    		encodedCurrentSampNames.push(sampNameEncoding[currentSampNames[sampN]]);
				    	}
				    	ajaxPost('/' + rName + '/getSampleExtractionInfo/' + projectName, {"sampNames": encodedCurrentSampNames}, function(tab){ mainPopInfoTab = tab; });
				    }
				 	sampleTable.updateWithData(mainPopInfoTab);
				};
				var sampMenu = new njhCheckboxMenu("#sampNameMenu", sampNames, updateChartOnClick);
				var popTable = new njhTable("#popTable", popInfoTab, longProjectName + "_extractionByFileInfo", true);
			}
		});
    </script>
  </body>
</html>
